<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.bitdaily.repository.mapper.RankMapper">
	
	
	<resultMap type="rank" id="rankMap">
		<result column="user_seq" property="userSeq" />
		<result column="total" property="total"/>
	</resultMap>

	<select id="selectActive" parameterType="dates" resultMap="rankMap">
		select user_seq, count(user_seq) as total
		from (select * from tb_recipe where recipe_date between #{startDate} and #{endDate} )
		group by user_seq
	</select>

   	<select id="selectExercise" parameterType="dates" resultMap="rankMap">
   		SELECT user_seq, sum(exercise_time) As total
		FROM (select * from tb_stat_exercise where exercise_date between #{startDate} and #{endDate})
		group by user_seq
		order by total desc
   	</select>
   	
   	<select id="selectWeight" parameterType="dates" resultMap="rankMap">
   		SELECT user_seq, (current_weight - goal_weight) AS total
		FROM tb_stat_weight
		WHERE (user_seq, TO_CHAR (weight_date, 'yyyy-mm-dd')) IN
		( SELECT user_seq,
		TO_CHAR (MAX (weight_date), 'yyyy-mm-dd') total
		FROM tb_stat_weight
		WHERE weight_date BETWEEN #{startDate}
		AND #{endDate}
		GROUP BY user_seq)
		ORDER BY total
   	</select>
   	
</mapper>






















